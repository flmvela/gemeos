#!/bin/bash

# Pre-commit hook to track changes automatically
echo "📝 Tracking changes..."

# Get list of staged files
STAGED_FILES=$(git diff --cached --name-only)

# Track edge functions
for file in $STAGED_FILES; do
  if [[ $file == supabase/functions/* ]]; then
    function_name=$(echo $file | cut -d'/' -f3)
    echo "  - Edge function modified: $function_name"
    
    # Add to tracking log
    echo "$(date '+%Y-%m-%d %H:%M:%S') - Modified: $file" >> .change-tracking/edge-functions.log
  fi
done

# Generate commit summary
commit_msg=$(git log -1 --pretty=%B 2>/dev/null || echo "Initial commit")
echo "$(date '+%Y-%m-%d %H:%M:%S') - Commit: $commit_msg" >> .change-tracking/commits.log

exit 0